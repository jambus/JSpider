#!/bin/bash
# install softwares
apt update
apt install -y python3-pip
pip3 install --upgrade pip
pip3 install pyspider
apt install -y unzip

# Download code and prepare
pip3 install pymongo
pip3 install sqlalchemy
pip3 install psycopg2

mkdir /home/ubuntu/projects
cd /home/ubuntu/projects
#wget -O jspider.zip --no-check-certificate https://github.com/jambus/JSpider/archive/master.zip
wget -O jspider.zip --no-check-certificate https://github.com/jambus/JSpider/archive/develop.zip
unzip jspider.zip
mv JSpider-develop/ JSpider
rm jspider.zip

# Assign owner to real executor
find . |xargs chown ubuntu

# execute startup script
echo "Software install complete, grant access & execute startup script."
cd JSpider
chmod 744 startup.sh
sudo -u ubuntu sh build/startup.sh&

#chmod 744 JSpider/HouseSpider/spider.sh
#cd JSpider/HouseSpider
#sudo -u ubuntu sh spider.sh&